apiVersion: 1

templates:
  - orgId: 1
    name: abemon.title
    template: |
      {{ define "abemon.title" -}}
      [{{ .Status | toUpper }}] {{ .CommonLabels.alertname }}
      {{- end }}

  - orgId: 1
    name: abemon.message
    template: |
      {{ define "abemon.message" -}}
      {{ if eq .Status "firing" }}ðŸ”´{{ else }}ðŸŸ¢{{ end }} **{{ .CommonLabels.alertname }}**

      **Status:** {{ .Status | title }}
      **Severity:** {{ .CommonLabels.severity | default "unknown" }}
      {{ if .CommonLabels.project }}**Project:** {{ .CommonLabels.project }}{{ end }}

      {{ range .Alerts }}
      ---
      {{ .Annotations.summary }}
      {{ if .Annotations.description }}
      {{ .Annotations.description }}
      {{ end }}
      **Started:** {{ .StartsAt.Format "2006-01-02 15:04:05 MST" }}
      {{ if .EndsAt }}**Ended:** {{ .EndsAt.Format "2006-01-02 15:04:05 MST" }}{{ end }}
      {{ end }}

      ---
      [View in Grafana]({{ .ExternalURL }}) | [Status Page](https://status.abemon.es)

      *abemon.es Observability*
      {{- end }}

  - orgId: 1
    name: abemon.email.subject
    template: |
      {{ define "abemon.email.subject" -}}
      [abemon] [{{ .Status | toUpper }}] {{ .CommonLabels.alertname }}
      {{- end }}

  - orgId: 1
    name: abemon.email.html
    template: |
      {{ define "abemon.email.html" -}}
      <!DOCTYPE html>
      <html>
      <head>
        <meta charset="utf-8">
        <style>
          body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #f5f5f5; margin: 0; padding: 20px; }
          .container { max-width: 600px; margin: 0 auto; background: #ffffff; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
          .header { background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%); padding: 20px; text-align: center; }
          .header img { width: 48px; height: 48px; margin-bottom: 10px; }
          .header h1 { color: #ffffff; font-size: 20px; margin: 0; }
          .status-firing { background: #EF4444; }
          .status-resolved { background: #10B981; }
          .status-bar { padding: 10px 20px; color: #ffffff; font-weight: bold; }
          .content { padding: 20px; }
          .alert-box { background: #f8f9fa; border-left: 4px solid #F25C1C; padding: 15px; margin: 10px 0; border-radius: 0 4px 4px 0; }
          .alert-box.critical { border-left-color: #EF4444; }
          .alert-box.warning { border-left-color: #F59E0B; }
          .meta { color: #666; font-size: 13px; margin-top: 10px; }
          .meta strong { color: #333; }
          .footer { background: #f8f9fa; padding: 15px 20px; text-align: center; font-size: 12px; color: #666; }
          .footer a { color: #F25C1C; text-decoration: none; }
          .btn { display: inline-block; background: #F25C1C; color: #ffffff; padding: 10px 20px; border-radius: 4px; text-decoration: none; margin-top: 15px; }
        </style>
      </head>
      <body>
        <div class="container">
          <div class="header">
            <img src="https://media.abemon.es/wp-content/uploads/2026/01/icon-512.png" alt="abemon">
            <h1>abemon Observability</h1>
          </div>
          {{ if eq .Status "firing" }}
          <div class="status-bar status-firing">ðŸ”´ ALERT FIRING</div>
          {{ else }}
          <div class="status-bar status-resolved">ðŸŸ¢ ALERT RESOLVED</div>
          {{ end }}
          <div class="content">
            <h2 style="margin-top:0;">{{ .CommonLabels.alertname }}</h2>
            {{ range .Alerts }}
            {{ if eq .Labels.severity "critical" }}
            <div class="alert-box critical">
            {{ else if eq .Labels.severity "warning" }}
            <div class="alert-box warning">
            {{ else }}
            <div class="alert-box">
            {{ end }}
              <p style="margin:0 0 10px 0;"><strong>{{ .Annotations.summary }}</strong></p>
              {{ if .Annotations.description }}<p style="margin:0; color:#666;">{{ .Annotations.description }}</p>{{ end }}
              <div class="meta">
                {{ if .Labels.project }}<strong>Project:</strong> {{ .Labels.project }}<br>{{ end }}
                <strong>Severity:</strong> {{ .Labels.severity | default "unknown" }}<br>
                <strong>Time:</strong> {{ .StartsAt.Format "2006-01-02 15:04:05 MST" }}
              </div>
            </div>
            {{ end }}
            <a href="{{ .ExternalURL }}" class="btn">View in Grafana</a>
          </div>
          <div class="footer">
            <p><a href="https://logs.abemon.es">Dashboard</a> | <a href="https://status.abemon.es">Status Page</a></p>
            <p>abemon.es Observability</p>
          </div>
        </div>
      </body>
      </html>
      {{- end }}
